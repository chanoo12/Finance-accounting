<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Accounts - SpendMate Finance</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="accounts.css">
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <a href="index.html">
                <img src="haha.png" alt="Logo" class="logo-img">SpendMate
            </a>
        </div>
        <ul>
            <li><a href="home.html">Home</a></li>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="general-ledger.html">General Ledger</a></li>
            <li><a href="accounts.html" class="active">Accounts Payable/Receivable</a></li>
            <li><a href="budgeting.html">Budgeting</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="accounts-section">
            <h2>Accounts Payable</h2>
            <div class="form-container">
                <h3>Add New Payable</h3>
                <form id="payableForm">
                    <div class="form-group">
                        <label for="payableSupplier">Supplier ID:</label>
                        <input type="number" id="payableSupplier" required>
                    </div>
                    <div class="form-group">
                        <label for="payableAmount">Amount:</label>
                        <input type="number" id="payableAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="payableDueDate">Due Date:</label>
                        <input type="date" id="payableDueDate" required>
                    </div>
                    <button type="submit" class="btn-primary">Add Payable</button>
                </form>
            </div>

            <div class="table-container">
                <table id="payableTable">
                    <thead>
                        <tr>
                            <th>Supplier ID</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Payables will be listed here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="accounts-section">
            <h2>Accounts Receivable</h2>
            <div class="form-container">
                <h3>Add New Receivable</h3>
                <form id="receivableForm">
                    <div class="form-group">
                        <label for="receivableCustomer">Customer ID:</label>
                        <input type="number" id="receivableCustomer" required>
                    </div>
                    <div class="form-group">
                        <label for="receivableAmount">Amount:</label>
                        <input type="number" id="receivableAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="receivableDueDate">Due Date:</label>
                        <input type="date" id="receivableDueDate" required>
                    </div>
                    <button type="submit" class="btn-primary">Add Receivable</button>
                </form>
            </div>

            <div class="table-container">
                <table id="receivableTable">
                    <thead>
                        <tr>
                            <th>Customer ID</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Receivables will be listed here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Fetch Accounts Payable
        async function fetchPayables() {
            try {
                const response = await fetch('http://localhost:3000/api/accounts-payable');
                const payables = await response.json();
                const tbody = document.querySelector('#payableTable tbody');
                tbody.innerHTML = '';
                
                payables.forEach(payable => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${payable.supplier_id}</td>
                        <td>$${payable.amount.toFixed(2)}</td>
                        <td>${new Date(payable.due_date).toLocaleDateString()}</td>
                        <td>
                            <button onclick="deletePayable(${payable.ap_id})" class="btn-delete">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching payables:', error);
            }
        }

        // Fetch Accounts Receivable
        async function fetchReceivables() {
            try {
                const response = await fetch('http://localhost:3000/api/accounts-receivable');
                const receivables = await response.json();
                const tbody = document.querySelector('#receivableTable tbody');
                tbody.innerHTML = '';
                
                receivables.forEach(receivable => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${receivable.customer_id}</td>
                        <td>$${receivable.amount.toFixed(2)}</td>
                        <td>${new Date(receivable.due_date).toLocaleDateString()}</td>
                        <td>
                            <button onclick="deleteReceivable(${receivable.ar_id})" class="btn-delete">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching receivables:', error);
            }
        }

        // Add Payable
        document.getElementById('payableForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                supplier_id: parseInt(document.getElementById('payableSupplier').value),
                amount: parseFloat(document.getElementById('payableAmount').value),
                due_date: document.getElementById('payableDueDate').value
            };

            try {
                const response = await fetch('http://localhost:3000/api/accounts-payable', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    e.target.reset();
                    fetchPayables();
                }
            } catch (error) {
                console.error('Error adding payable:', error);
            }
        });

        // Add Receivable
        document.getElementById('receivableForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                customer_id: parseInt(document.getElementById('receivableCustomer').value),
                amount: parseFloat(document.getElementById('receivableAmount').value),
                due_date: document.getElementById('receivableDueDate').value
            };

            try {
                const response = await fetch('http://localhost:3000/api/accounts-receivable', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    e.target.reset();
                    fetchReceivables();
                }
            } catch (error) {
                console.error('Error adding receivable:', error);
            }
        });

        // Delete Payable
        async function deletePayable(id) {
            if (confirm('Are you sure you want to delete this payable?')) {
                try {
                    const response = await fetch(`http://localhost:3000/api/accounts-payable/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        fetchPayables();
                    }
                } catch (error) {
                    console.error('Error deleting payable:', error);
                }
            }
        }

        // Delete Receivable
        async function deleteReceivable(id) {
            if (confirm('Are you sure you want to delete this receivable?')) {
                try {
                    const response = await fetch(`http://localhost:3000/api/accounts-receivable/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        fetchReceivables();
                    }
                } catch (error) {
                    console.error('Error deleting receivable:', error);
                }
            }
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', () => {
            fetchPayables();
            fetchReceivables();
        });
    </script>
</body>
</html>
