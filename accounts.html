<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accounts - SpendMate Finance</title>
    <link rel="stylesheet" href="accounts.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter&family=Poppins&family=Quicksand&display=swap" rel="stylesheet">
</head>
<body>
    <div class="sidebar">
        <ul>
            <li><a href="home.html">Home</a></li>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="general-ledger.html">General Ledger</a></li>
            <li><a href="budgeting.html">Budgeting</a></li>
        </ul>
    </div>
    
    <div class="main-content">
        <div class="accounts-section">
            <h2>Accounts Payable</h2>
            <div class="form-container">
                <h3>Add New Payable</h3>
                <form id="payableForm">
                    <div class="form-group">
                        <label for="payableSupplierName">Supplier Name:</label>
                        <input type="text" id="payableSupplierName" required>
                    </div>
                    <div class="form-group">
                        <label for="payableSupplier">Supplier ID:</label>
                        <input type="number" id="payableSupplier" required>
                    </div>
                    <div class="form-group">
                        <label for="payableAmount">Amount:</label>
                        <input type="number" id="payableAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="payableDueDate">Due Date:</label>
                        <input type="date" id="payableDueDate" required>
                    </div>
                    <button type="submit" class="btn-primary">Add Payable</button>
                </form>
            </div>

            <div class="table-container">
                <table id="payableTable">
                    <thead>
                        <tr>
                            <th>Supplier ID</th>
                            <th>Supplier Name</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="accountsPayableTableBody"></tbody>

                </table>
            </div>
        </div>

        <div class="accounts-section">
            <h2>Accounts Receivable</h2>
            <div class="form-container">
                <h3>Add New Receivable</h3>
                <form id="receivableForm">
                    <div class="form-group">
                        <label for="receivableCustomerName">Customer Name:</label>
                        <input type="text" id="receivableCustomerName" required>
                    </div>
                    <div class="form-group">
                        <label for="receivableCustomer">Customer ID:</label>
                        <input type="number" id="receivableCustomer" required>
                    </div>
                    <div class="form-group">
                        <label for="receivableAmount">Amount:</label>
                        <input type="number" id="receivableAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="receivableDueDate">Due Date:</label>
                        <input type="date" id="receivableDueDate" required>
                    </div>
                    <button type="submit" class="btn-primary">Add Receivable</button>
                </form>
            </div>

            <div class="table-container">
                <table id="receivableTable">
                    <thead>
                        <tr>
                            <th>Customer ID</th>
                            <th>Customer Name</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="accountsPayableTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Fetch and render Accounts Payable
        async function fetchPayables() {
            try {
                const response = await fetch('/api/accounts-payable');
                const payables = await response.json();
                const tbody = document.querySelector('#payableTable tbody');
                tbody.innerHTML = '';
                payables.forEach(payable => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${payable.supplier_id}</td>
                        <td>${payable.supplier_name}</td>
                        <td>$${Number(payable.amount).toFixed(2)}</td>
                        <td>${new Date(payable.due_date).toLocaleDateString()}</td>
                        <td>
                            <button class="btn-delete" onclick="deletePayable(${payable.ap_id})">Delete</button>
                            <button class="btn-edit" onclick="editPayable(${payable.ap_id})">Edit</button>
                            <button class="btn-view" onclick="viewPayable(${payable.ap_id})">View</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                alert('Failed to load payables');
            }
        }

        // Fetch Accounts Receivable
        async function fetchReceivables() {11
            try {
                const response = await fetch('http://localhost:3000/api/accounts-receivable');
                const receivables = await response.json();
                const tbody = document.querySelector('#receivableTable tbody');
                tbody.innerHTML = '';
                
                receivables.forEach(receivable => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${receivable.customer_id}</td>
                        <td>${receivable.customer_name}</td>
                        <td>$${Number(receivable.amount).toFixed(2)}</td>
                        <td>${new Date(receivable.due_date).toLocaleDateString()}</td>
                        <td>
                            <button onclick="deleteReceivable(${receivable.ar_id})" class="btn-delete">Delete</button>
                            <button onclick="viewReceivable(${receivable.ar_id})" class="btn-view">View</button>
                            <button onclick="editReceivable(${receivable.ar_id})" class="btn-edit">Edit</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching receivables:', error);
            }
        }

        // Add Payable
        document.getElementById('payableForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                supplier_id: parseInt(document.getElementById('payableSupplier').value),
                supplier_name: document.getElementById('payableSupplierName').value,
                amount: parseFloat(document.getElementById('payableAmount').value),
                due_date: document.getElementById('payableDueDate').value
            };

            try {
                const response = await fetch('http://localhost:3000/api/accounts-payable', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    e.target.reset();
                    fetchPayables();
                }
            } catch (error) {
                console.error('Error adding payable:', error);
            }
        });

        // Add Receivable
        document.getElementById('receivableForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                customer_id: parseInt(document.getElementById('receivableCustomer').value),
                customer_name: document.getElementById('receivableCustomerName').value,
                amount: parseFloat(document.getElementById('receivableAmount').value),
                due_date: document.getElementById('receivableDueDate').value
            };

            try {
                const response = await fetch('http://localhost:3000/api/accounts-receivable', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    e.target.reset();
                    fetchReceivables();
                }
            } catch (error) {
                console.error('Error adding receivable:', error);
            }
        });

        // Delete Payable
        async function deletePayable(id) {
            if (confirm('Are you sure you want to delete this payable?')) {
                try {
                    const response = await fetch(`http://localhost:3000/api/accounts-payable/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        fetchPayables();
                    }
                } catch (error) {
                    console.error('Error deleting payable:', error);
                }
            }
        }

           // View Payable
           async function viewPayable(id) {
               try {
                   const response = await fetch(`/api/accounts-payable/${id}`);
                   const entry = await response.json();
                   alert(`Supplier ID: ${entry.supplier_id}\nSupplier Name: ${entry.supplier_name}\nAmount: ${entry.amount}\nDue Date: ${entry.due_date}`);
               } catch (error) {
                   alert('Failed to view payable');
               }
           }

           // Edit Payable (simple prompt-based)
           async function editPayable(id) {
               try {
                   const response = await fetch(`/api/accounts-payable/${id}`);
                   const entry = await response.json();
                   const supplier_id = prompt('Supplier ID:', entry.supplier_id);
                   const supplier_name = prompt('Supplier Name:', entry.supplier_name);
                   const amount = prompt('Amount:', entry.amount);
                   const due_date = prompt('Due Date:', entry.due_date);
                   if (supplier_id && supplier_name && amount && due_date) {
                       await fetch(`/api/accounts-payable/${id}`, {
                           method: 'PUT',
                           headers: { 'Content-Type': 'application/json' },
                           body: JSON.stringify({ supplier_id, supplier_name, amount, due_date })
                       });
                       fetchPayables();
                   }
               } catch (error) {
                   alert('Failed to edit payable');
               }
           }

        // Delete Receivable
        async function deleteReceivable(id) {
            if (confirm('Are you sure you want to delete this receivable?')) {
                try {
                    const response = await fetch(`http://localhost:3000/api/accounts-receivable/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        fetchReceivables();
                    }
                } catch (error) {
                    console.error('Error deleting receivable:', error);
                }
            }
        }

           // View Receivable
           async function viewReceivable(id) {
               try {
                   const response = await fetch(`/api/accounts-receivable/${id}`);
                   const entry = await response.json();
                   alert(`Customer ID: ${entry.customer_id}\nCustomer Name: ${entry.customer_name}\nAmount: ${entry.amount}\nDue Date: ${entry.due_date}`);
               } catch (error) {
                   alert('Failed to view receivable');
               }
           }

           // Edit Receivable (simple prompt-based)
           async function editReceivable(id) {
               try {
                   const response = await fetch(`/api/accounts-receivable/${id}`);
                   const entry = await response.json();
                   const customer_id = prompt('Customer ID:', entry.customer_id);
                   const customer_name = prompt('Customer Name:', entry.customer_name);
                   const amount = prompt('Amount:', entry.amount);
                   const due_date = prompt('Due Date:', entry.due_date);
                   if (customer_id && customer_name && amount && due_date) {
                       await fetch(`/api/accounts-receivable/${id}`, {
                           method: 'PUT',
                           headers: { 'Content-Type': 'application/json' },
                           body: JSON.stringify({ customer_id, customer_name, amount, due_date })
                       });
                       fetchReceivables();
                   }
               } catch (error) {
                   alert('Failed to edit receivable');
               }
           }

        document.addEventListener('DOMContentLoaded', () => {
            fetchPayables();
            fetchReceivables();
        });
    </script>
</body>
</html>
